<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBL : To Do List</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
    <style>
        :root {
            --brand-white: #FFF;
            --grayscale-100: #EEF1F3;
            --grayscale-200: #D8DFE3;
            --grayscale-300: #A9B5BC;
            --grayscale-400: #94A1A8;
            --grayscale-500: #727E84;
            --grayscale-600: #54595B;
            --grayscale-700: #323539;
            --grayscale-800: #232629;
            --grayscale-900: #131517;
            --ui-warning: #E14B4D;
            --ui-caution: #FFAB01;
            --ui-success: #28C28B;
            --ui-information: #3B84D8;
        }
        /* reset */
        *:not(.material-icons) {font-family: 'Pretendard', 'Apple SD Gothic Neo', 'san-serif'!important; box-sizing: border-box;}
        a {color: initial; text-decoration: none;}
        button {background-color: transparent; border: none; padding: 0px; cursor: pointer;}
        .material-icons {color: var(--grayscale-700);}
        .blind {position: absolute; width: 1px; height: 1px; clip: rect(1px, 1px, 1px, 1px); overflow: hidden;}
        body {position: relative; display: flex; justify-content: center; align-items: center; width: 100vw; min-width: 500px; max-width: 100vw; height: 100vh; min-height: 450px; max-height: 100vh; padding: 40px; background-color: #F2F5F8;}
        @media (max-width: 640px) , (max-height: 560px) {
            body {padding: 20px;}
        }
        /* reset */
    </style>
    <style>
        .area-main {width: 100%; max-width: 680px; height: 100%; padding: 24px; border-radius: 16px; box-shadow:  20px 20px 60px #ced0d3, -20px -20px 60px #ffffff; background-color: #FFF; overflow: hidden;}
        
        .area-main__inputBox {position: relative; display: block; width: 100%; height: auto; margin: 0px 0px 48px;}
        .area-main__inputBox input {display: block; width: 100%; height: 48px; padding: 8px 64px 8px 14px; border: 1px solid var(--grayscale-200); border-radius: 8px; font-size: 17px; font-weight: 400; color: var(--grayscale-700); line-height: 30px; outline: none; box-shadow: 0px 0px 0px transparent; background-color: var(--grayscale-100); transition: background 0.2s, border 0.2s;}
        .area-main__inputBox input:focus {padding: 8px 14px; border-color: var(--ui-information); background-color: var(--brand-white); box-shadow: 0px 4px 12px rgba(0, 20, 40, 0.1);}
        .area-main__inputBox input::placeholder {color: var(--grayscale-300);}
        .area-main__inputHotkeyBadge {position: absolute; top: 0px; bottom: 0px; right: 14px; display: inline-block; width: auto; height: fit-content; padding: 4px; margin: auto 0px; font-size: 14px; white-space: nowrap; border-radius: 4px; background-color: var(--grayscale-200); visibility: visible; opacity: 1; transition: opacity 0.2s;}
        .area-main__inputBox input:focus ~ .area-main__inputHotkeyBadge {visibility: hidden; opacity: 0;}
        .area-main__inputTooltip {position: absolute; bottom: -32px; left: -4px; padding: 8px 12px 8px 8px; font-size: 15px; color: var(--grayscale-100); white-space: nowrap; border-radius: 8px; background-color: var(--grayscale-700); visibility: hidden; opacity: 0; transform: translateY(20%); transition: all 0.5s;}
        .area-main__inputTooltip::before {content: ""; position: absolute; top: -5px; left: 14px; width: 0px; height: 0px; border-bottom: 6px solid var(--grayscale-700); border-left: 5px solid transparent; border-right: 5px solid transparent;}
        .area-main__inputTooltip > span {display: inline-block; padding: 4px; margin-right: 4px; font-size: 14px; font-weight: 400; color: var(--brand-white); border-radius: 4px; background-color: var(--grayscale-600);}
        .area-main__inputBox--tooltip .area-main__inputTooltip {visibility: visible; opacity: 0.9; transform: translateY(0%);}
        
        .area-main__cts {display: flex; flex-flow: column nowrap; justify-content: space-between; align-items: stretch; height: calc(100% - 96px); max-height: calc(100% - 96px);}
        .area-main__ctsTop {position: relative; display: block; width: 100%; max-height: calc(100% - 45px);}
        .area-main__ctsTop::after {content: ""; position: absolute; bottom: 0px; left: 0px; right: 0px; height: 30px; background: linear-gradient(180deg, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100%);}
        .area-main__ctsTitle {display: block; margin: 0px 0px 12px; padding: 0px 2px; font-size: 18px; font-weight: 700; color: var(--grayscale-900);}
        .area-main__ctsList {display: block; width: 100%; height: calc(100% - 30px); max-height: calc(100% - 30px); padding: 0px 0px 30px; overflow-y: auto;}
        .area-main__ctsList::-webkit-scrollbar {display: none;}
        
        .area-main__ctsBottom {display: flex; flex-flow: row nowrap; justify-content: space-between; align-items: center; padding: 12px 2px 0px; border-top: 1px solid var(--grayscale-200);}
        .area-main__ctsLengthTxt {display: block; width: auto; height: auto; font-size: 15px; font-weight: 400; color: var(--grayscale-500);}
        .area-main__ctsLengthTxt span {display: inline; font-size: 16px; font-weight: inherit; color: inherit;}
        .area-main__ctsClearBtn {display: flex; justify-content: center; align-items: center; width: auto; height: auto; padding: 4px;}
        .area-main__ctsClearBtn span:last-of-type {display: inline-block; margin-left: 2px; font-size: 15px; font-weight: 600; color: var(--grayscale-400); transition: color 0.2s;}
        .area-main__ctsClearBtn:hover span:last-of-type,
        .area-main__ctsClearBtn:active span:last-of-type,
        .area-main__ctsClearBtn:focus span:last-of-type {color: var(--ui-warning);}
        .area-main__ctsClearBtn .material-icons {color: var(--grayscale-400); transition: color 0.2s;}
        .area-main__ctsClearBtn:hover .material-icons,
        .area-main__ctsClearBtn:active .material-icons,
        .area-main__ctsClearBtn:focus .material-icons {color: var(--ui-warning);}
        
        .area-main__ctsItem {display: flex; flex-flow: row nowrap; justify-content: space-between; align-items: center; padding: 12px; border: 1px solid var(--grayscale-200); border-radius: 8px;}
        .area-main__ctsItem + .area-main__ctsItem {margin: 8px 0px 0px;}
        .area-main__ctsItem--checked {border-color: var(--grayscale-100); background-color: var(--grayscale-100);}
        .area-main__ctsItemLeft {display: flex; justify-content: flex-start; align-items: center; max-width: calc(100% - 160px); margin-right: 24px;}
        .area-main__ctsItemRight {display: flex; justify-content: flex-end; align-items: center;}
        .area-main__ctsItemTitle {display: block; height: auto; font-size: 16px; font-weight: 500; color: var(--grayscale-800); white-space: nowrap; text-overflow: ellipsis; overflow: hidden;}
        .area-main__ctsItem--checked .area-main__ctsItemTitle {color: var(--grayscale-500); text-decoration: line-through;}
        .area-main__ctsItemTime {display: inline-block; margin-right: 6px; font-size: 14px; font-weight: 400; color: var(--grayscale-500); letter-spacing: -0.25px; white-space: nowrap;}
        .area-main__ctsItemDelete {display: flex; justify-content: center; align-items: center;}
        .area-main__ctsItemDelete .material-icons {font-size: 24px; color: var(--grayscale-400); transition: color 0.2s;}
        .area-main__ctsItemDelete:hover .material-icons,
        .area-main__ctsItemDelete:active .material-icons,
        .area-main__ctsItemDelete:focus .material-icons {color: var(--ui-warning);}

        .area-main__ctsItemChk {position: relative; display: flex; justify-content: center; align-items: center; width: 24px; height: 24px; margin-right: 12px; font-size: 9px; cursor: pointer;}
        .area-main__ctsItemChk input {position: absolute; width: 1px; height: 1px; visibility: hidden; opacity: 0;}
        .area-main__ctsItemChk svg {overflow: visible;}
        .area-main__ctsItemChk svg .path {fill: none; stroke: var(--grayscale-300); stroke-width: 6; stroke-linecap: round; stroke-linejoin: round; transition: stroke-dasharray 0.5s ease, stroke-dashoffset 0.5s ease; stroke-dasharray: 241 9999999; stroke-dashoffset: 0;}
        .area-main__ctsItemChk input:checked ~ svg .path {stroke: var(--grayscale-500); stroke-dasharray: 70.5096664428711 9999999; stroke-dashoffset: -262.2723388671875;}

        .area-main__ctsNone {display: block; width: 100%; height: auto; padding: 48px 12px; margin: 0px 0px 20px; border: 1px solid var(--grayscale-200); border-radius: 8px;}
        .area-main__ctsNone p {position: relative; display: block; width: 100%; height: auto; padding: 60px 0px 0px; font-size: 16px; font-weight: 500; color: var(--grayscale-600); text-align: center; white-space: nowrap;}
        .area-main__ctsNone p::before {content: "!"; position: absolute; top: 0px; left: 0px; right: 0px; width: 42px; height: 42px; margin: 0px auto; border: 1px solid var(--grayscale-500); font-size: 20px; font-weight: 700; text-align: center; line-height: 42px; border-radius: 50%;}

        .area-main__ctsLoaderBox {display: flex; justify-content: center; align-items: center; padding: 80px 20px;}
        .area-main__ctsLoader {width: 8px; aspect-ratio: 1; border-radius: 50%; overflow: visible; animation: loader 1s infinite linear alternate;}
        @keyframes loader {
            0%  {box-shadow: 16px 0 rgba(0, 20, 40, 1), -16px 0 rgba(0, 20, 40, 0.2); background: rgba(0, 20, 40, 1) }
            33% {box-shadow: 16px 0 rgba(0, 20, 40, 1), -16px 0 rgba(0, 20, 40, 0.2); background: rgba(0, 20, 40, 0.2)}
            66% {box-shadow: 16px 0 rgba(0, 20, 40, 0.2), -16px 0 rgba(0, 20, 40, 1); background: rgba(0, 20, 40, 0.2)}
            100%{box-shadow: 16px 0 rgba(0, 20, 40, 0.2), -16px 0 rgba(0, 20, 40, 1); background: rgba(0, 20, 40, 1) }
        }
        </style>
</head>
<body>
    <main class="area-main" role="main">
        <h1 class="blind" role="heading">To Do List</h1>
        <section class="area-main__inputBox">
            <input id="listInput" type="text" placeholder="오늘의 할 일을 입력해주세요" maxlength="30">
            <span class="area-main__inputHotkeyBadge">⌘↩︎</span>
            <p class="area-main__inputTooltip"><span>ENTER</span> 할 일 추가</p>
        </section>
        <article class="area-main__cts">
            <div class="area-main__ctsTop">
                <h2 class="area-main__ctsTitle" role="heading">Today's To Do List</h2>
                <ul id="listContainer" class="area-main__ctsList" role="list"></ul>
            </div>
            <div class="area-main__ctsBottom">
                <p class="area-main__ctsLengthTxt">할 일: <span id="listLengthTxt">0</span>개</p>
                <button id="clearBtn" class="area-main__ctsClearBtn" type="button"><span class="material-icons">cancel</span><span>초기화</span></button>
            </div>
        </article>

        <script>
            const listInput = document.getElementById('listInput');
            const listContainer = document.getElementById('listContainer');
            const listLengthTxt = document.getElementById('listLengthTxt');
            const listClearBtn = document.getElementById('clearBtn');

            function listTemplate(state, item) {
                if (state) {
                    return `
                        <li class="area-main__ctsItem ${item.state ? '' : 'area-main__ctsItem--checked'}" role="listitem" data-index="${item.index}">
                            <div class="area-main__ctsItemLeft">
                                <label class="area-main__ctsItemChk" tabIndex="0">
                                    <input type="checkbox" ${item.state ? '' : 'checked'}>
                                    <svg viewBox="0 0 64 64" height="2em" width="2em">
                                        <path d="M 0 16 V 56 A 8 8 90 0 0 8 64 H 56 A 8 8 90 0 0 64 56 V 8 A 8 8 90 0 0 56 0 H 8 A 8 8 90 0 0 0 8 V 16 L 32 48 L 64 16 V 8 A 8 8 90 0 0 56 0 H 8 A 8 8 90 0 0 0 8 V 56 A 8 8 90 0 0 8 64 H 56 A 8 8 90 0 0 64 56 V 16" pathLength="575.0541381835938" class="path"></path>
                                    </svg>
                                </label>
                                <h3 class="area-main__ctsItemTitle">${item.title ?? 'list title'}</h3>
                            </div>
                            <div class="area-main__ctsItemRight">
                                <p class="area-main__ctsItemTime">${item.time ?? 'created time'}</p>
                                <button class="area-main__ctsItemDelete" type="button" role="button"><span class="material-icons">delete</span></button>
                            </div>
                        </li>
                        `;
                } else return `<li class="area-main__ctsNone"><p>할 일이 없습니다</p></li>`;    
            }

            function loadList() {
                const activeListArr = JSON.parse(window.localStorage.getItem('activeList')) ?? [];
                const passiveListArr = JSON.parse(window.localStorage.getItem('passiveList')) ?? [];

                listContainer.innerHTML = `<div class="area-main__ctsLoaderBox"><div class="area-main__ctsLoader"></div></div>`;

                function uiEventBinding() {
                    const deleteBtns = listContainer.querySelectorAll(".area-main__ctsItemDelete");
                    const checkBoxs = listContainer.querySelectorAll('input[type="checkbox"]');
                    const checkLabels = listContainer.querySelectorAll(".area-main__ctsItemChk");
                    deleteBtns.forEach(el => el.addEventListener('click', deleteList));
                    checkBoxs.forEach(el => el.addEventListener('change', changeListState));
                    checkLabels.forEach(el => el.addEventListener('keydown', (e) => {
                        if (e.keyCode == 13) el.children[0].click();
                    }));
                }

                if (activeListArr.length !== 0) {
                    listContainer.innerHTML = '';
                    [...activeListArr].reverse().forEach(el => listContainer.innerHTML += listTemplate(1, el));
                    if (passiveListArr.length !== 0) {
                        [...passiveListArr].reverse().forEach(el => listContainer.innerHTML += listTemplate(1, el));
                    }
                    uiEventBinding();
                } else {
                    if (passiveListArr.length !== 0) {
                        listContainer.innerHTML = '';
                        [...passiveListArr].reverse().forEach(el => listContainer.innerHTML += listTemplate(1, el));
                        uiEventBinding();
                    } else listContainer.innerHTML = listTemplate(0);
                }
                listLengthTxt.textContent = activeListArr.length;
            }
            loadList();

            function addList() {
                if (listInput.value) {
                    const activeListArr = JSON.parse(window.localStorage.getItem('activeList')) ?? [];
                    const listItemObj = {};
                    const timeFormatOpt = { month: '2-digit', day: '2-digit', weekday: 'short', hourCycle: 'h24', hour: '2-digit', minute: '2-digit' };
                    
                    listItemObj.state = true;
                    listItemObj.index = activeListArr.length;
                    listItemObj.title = listInput.value;
                    listItemObj.indexTime = new Date();
                    listItemObj.time = new Intl.DateTimeFormat('ko-KR', timeFormatOpt).format(listItemObj.indexTime);
    
                    window.localStorage.setItem('activeList', JSON.stringify([...activeListArr, listItemObj]));
                    loadList();
                    listInput.value = '';
                } else alert('이름을 입력해주세요');
            }

            function deleteList(e) {
                const targetItem = this.parentNode.parentNode;
                const itemState = targetItem.classList.contains('area-main__ctsItem--checked');
                const targetStorageKey = itemState ? 'passiveList' : 'activeList';
                const readListArr = JSON.parse(window.localStorage.getItem(targetStorageKey));
                const targetListArr = [...readListArr];
                const itemIdx = Number(targetItem.dataset.index);
                
                targetListArr.splice(itemIdx, 1);
                targetListArr.forEach((el, idx) => el.index = idx);
                window.localStorage.setItem(targetStorageKey, JSON.stringify(targetListArr));
                loadList();
            }

            function changeListState(e) {
                setTimeout(() => loadList(), 600);

                const targetItem = this.parentNode.parentNode.parentNode;
                const isChecked = this.checked; // true : 리스트 내림, false : 다시 올림
                const itemIdx = Number(targetItem.dataset.index);

                // 함수를 실행한 아이템이 속한 배열 추출
                const changeStorageKey = isChecked ? 'activeList' : 'passiveList';
                const readChangeListArr = JSON.parse(window.localStorage.getItem(changeStorageKey));
                const changeListArr = [...readChangeListArr];

                // 함수를 실행한 아이템을 추출 후 넣을 배열
                const targetStorageKey = isChecked ? 'passiveList' : 'activeList';
                const readTargetListArr = JSON.parse(window.localStorage.getItem(targetStorageKey));
                const targetListArr = [...readTargetListArr];

                // 함수를 실행한 아이템 추출 & 상태 변경 & 새 배열에 추가
                const changeItem = changeListArr.splice(itemIdx, 1);
                changeItem[0].state = !changeItem[0].state;
                targetListArr.push(changeItem[0]);

                // 새로운 배열 개수가 1개 이상일 시 시간 순 정렬 & 인덱스 초기화 & 배열 저장
                if (targetListArr.length > 1) targetListArr.sort((a, b) => new Date(a.indexTime) - new Date(b.indexTime));
                targetListArr.forEach((el, idx) => el.index = idx);
                window.localStorage.setItem(targetStorageKey, JSON.stringify(targetListArr));

                // 기존 배열 인덱스 정렬 및 저장
                changeListArr.forEach((el, idx) => el.index = idx);
                window.localStorage.setItem(changeStorageKey, JSON.stringify(changeListArr));
            }

            function clearList() {
                const alertTxt = '초기화 시 할 일 목록이 모두 삭제되며, \n다시는 복구할 수 없습니다 \n초기화 하시겠습니까?';
                if (confirm(alertTxt)) {
                    window.localStorage.setItem('activeList', '[]');
                    window.localStorage.setItem('passiveList', '[]');
                    loadList();
                }
            }
            
            window.addEventListener('keydown', (e) => {
                const hotKey = window.navigator.platform.toLowerCase().indexOf('mac') >= 0 ? e.metaKey : e.altKey;
                if (hotKey && e.keyCode == 13) listInput.focus();
            });
            listInput.addEventListener('keydown', (e) => {
                if (e.keyCode == 13) addList();
                else if (e.keyCode == 27) listInput.blur();

                if (listInput.value !== '') {
                    listInput.parentNode.classList.remove('area-main__inputBox--tooltip');
                }
            });
            listInput.addEventListener('focus', (e) => {
                if (Number(listLengthTxt.textContent) <= 0 && listInput.value === '') {
                    listInput.parentNode.classList.add('area-main__inputBox--tooltip');
                }
            });
            listInput.addEventListener('blur', (e) => {
                listInput.parentNode.classList.remove('area-main__inputBox--tooltip');
            });
            listClearBtn.addEventListener('click', clearList);
        </script>
    </main>
</body>
</html>